[platformio]
default_envs = default
extra_configs = platformio.local.ini
packages_dir = .pio/packages

[papyrix]
version = 1.13.0

[base]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/55.03.37/platform-espressif32.zip
board = esp32-c3-devkitm-1
framework = arduino
monitor_speed = 115200
upload_speed = 921600
check_tool = cppcheck
check_flags = --enable=all --suppress=missingIncludeSystem --suppress=unusedFunction --suppress=unmatchedSuppression --suppress=*:*/.pio/* --inline-suppr
check_skip_packages = yes

build_unflags = -fno-lto

board_upload.flash_size = 16MB
board_upload.maximum_size = 16777216
board_upload.offset_address = 0x10000

build_flags =
  -flto=auto
  -DARDUINO_USB_MODE=1
  -DARDUINO_USB_CDC_ON_BOOT=1
  -DEINK_DISPLAY_SINGLE_BUFFER_MODE=1
  -DDISABLE_FS_H_WARNING=1
# Enable UTF-8 filenames for Cyrillic and other non-ASCII characters
  -DUSE_UTF8_LONG_NAMES=1
# https://libexpat.github.io/doc/api/latest/#XML_GE
  -DXML_GE=1
# Enable DTD processing so XML_UseForeignDTD works for HTML entity resolution
  -DXML_DTD
  -DXML_CONTEXT_BYTES=512
  -std=c++2a
  -Isrc
  -Ilib
  -Ilib/Epub
  -Ilib/Fb2

; Board configuration
board_build.flash_mode = dio
board_build.flash_size = 16MB
board_build.partitions = partitions.csv
board_build.filesystem = littlefs

extra_scripts =
  pre:scripts/build_html.py

; Libraries (SDK libs now in lib/ folder)
lib_deps =
  bblanchon/ArduinoJson @ 7.4.2
  ricmoo/QRCode @ 0.0.1
  kikuchan98/pngle @ 1.0.2
  file://lib/Hyphenation

[env:default]
extends = base
build_flags =
  ${base.build_flags}
  -DPAPYRIX_VERSION=\"${papyrix.version}-dev\"
  -DENABLE_SERIAL_LOG
  -DLOG_LEVEL=2

[env:gh_release]
extends = base
build_flags =
  ${base.build_flags}
  -DPAPYRIX_VERSION=\"${papyrix.version}\"
  -DENABLE_SERIAL_LOG
  -DLOG_LEVEL=0
